<?php
defined('BASEPATH') OR exit('No direct script access allowed');

use PhpOffice\PhpSpreadsheet\IOFactory;
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;
use PhpOffice\PhpSpreadsheet\Style\Fill;
use PhpOffice\PhpSpreadsheet\Style\Color;

class Employee extends CI_Controller {

	public function __construct(){
		parent::__construct();
		if (!$this->session->userdata('logged_in')) redirect("/auth/login");
		
		date_default_timezone_set('America/Lima');
		$this->load->model('general_model','gen_m');
		$this->load->model('employee_model', 'emp_m');
		$this->load->model('vacation_model', 'vac_m');
		$this->load->model('working_hour_model', 'whour_m');
		$this->nav_menu = ["hr", "employee"];
	}
	
	private function excel_date_to_php($value){
		return \PhpOffice\PhpSpreadsheet\Shared\Date::excelToDateTimeObject($value)->format('Y-m-d');
	}

	public function index(){
		$page = $this->input->get("page"); if (!$page) $page = 1;
		
		$locs = [];
		$locs_rec = $this->gen_m->all("location");
		foreach($locs_rec as $l) $locs[$l->location_id] = $l;
		
		$depts = [];
		$depts_rec = $this->gen_m->all("department");
		foreach($depts_rec as $d) $depts[$d->department_id] = $d;
		
		$orgs = [];
		$orgs_rec = $this->gen_m->all("organization");
		foreach($orgs_rec as $o) $orgs[$o->organization_id] = $o;
		
		$subs = [];
		$subs_rec = $this->gen_m->all("subsidiary");
		foreach($subs_rec as $s) $subs[$s->subsidiary_id] = $s;
		
		$employees = $this->emp_m->all([["name", "asc"]]);
		foreach($employees as $emp){
			if ($emp->department_id){
				$dept = $depts[$emp->department_id];
				$org = $orgs[$dept->organization_id];
				$sub = $subs[$org->subsidiary_id];
				
				$emp->department = $dept->department;
				$emp->organization = $org->organization;
				$emp->subsidiary = $sub->subsidiary;
			}else{
				$emp->department = "";
				$emp->organization = "";
				$emp->subsidiary = "";
			}
			
			$emp->location = ($emp->location_id) ? $locs[$emp->location_id]->location : "";
		}
		
		$data = [
			"employees" => $employees,
			"main" => "module/employee/index",
		];
		$this->load->view('layout', $data);
	}
	
	public function preset_employee(){
		/* read excel file and insert employees */
		
		//load from excel file
		$spreadsheet = IOFactory::load("./upload/preset/employee.xlsx");
		$sheet = $spreadsheet->getActiveSheet();
		
		$maxRow = $sheet->getHighestRow();
		if ($maxRow){
			$insert_data = $update_data = [];
			$count = 0;
			for ($row = 2; $row <= $maxRow; $row++){
				$loc = $this->gen_m->unique("location", "location", trim($sheet->getCell('D'.$row)->getValue()));
				$dept = $this->gen_m->unique("department", "department", trim($sheet->getCell('C'.$row)->getValue()));
				
				$aux = [
					"location_id" => $loc->location_id,
					"department_id" => $dept->department_id,
					"employee_number" => trim($sheet->getCell('E'.$row)->getValue()),
					"name" => trim($sheet->getCell('F'.$row)->getValue()),
					"is_supervised" => (trim($sheet->getCell('G'.$row)->getValue()) === "Fiscalizado") ? true : false,
				];
				
				$emp = $this->gen_m->filter("employee", true, ["employee_number" => $aux["employee_number"]]);
				if ($emp){//employee exits
					$aux["employee_id"] = $emp[0]->employee_id;
					$update_data[] = $aux;
				}else{//new employee
					$insert_data[] = $aux;
				}
			}
			
			if ($insert_data) $this->gen_m->insert_m("employee", $insert_data);
			if ($update_data) $this->gen_m->update_multi("employee", $update_data, "employee_id");
			
			echo "New employee: ".count($insert_data)."<br/>Updated employee: ".count($update_data);
		}
	}
	
	public function preset_department(){
		/* prepare array of [organization, department] */
		$depts = [['CFO','Accounting & Tax'], ['CFO','Accounting'], ['CFO','Tax'], ['CFO','AR & AP Management'], ['CFO','Treasury'], ['CFO','AR & Credit'], ['CFO','CFO'], ['CFO','Business Management'], ['CFO','General Procurement'], ['CFO','Planning'], ['CFO','Process Innovation & IT'], ['CFO','Legal'], ['CFO','SCM'], ['CFO','WH Management'], ['CFO','Order Management'], ['CFO','Import Logistics'], ['CFO','Sales Administration'], ['MARKETING','Marketing'], ['MARKETING','Brand Marketing'], ['MARKETING','OBS'], ['GTM','GTM'], ['GTM','Promotor/Retail Marketing CE'], ['GTM','ISM'], ['GTM','SOM'], ['PRODUCTO AC','Air Solution'], ['PRODUCTO CAV','AV Product'], ['PRODUCTO HA','HA Product'], ['PRODUCTO IT ID','IT&ID Product'], ['PRODUCTO TV','HE Product'], ['RRHH','Human Resources'], ['SVC','SVC'], ['SVC','CIC Operation'], ['SVC','LG SVC Center'], ['SVC','SVC Networks & Parts'], ['SVC','Technical Support'], ['Ventas AC','B2B SAC Engineering'], ['Ventas AC','B2B SAC Sales'], ['Ventas AC','RAC Sales'], ['Ventas B2B','B2B / IT'], ['Ventas B2B2C','B2B2C / Family Club'], ['VENTAS CE','CE Sales'], ['VENTAS CE','HA Sales (CE)'], ['VENTAS CE','HE Sales (CE)'], ['VENTAS CE','HA/HE Sales (CE)'], ['Ventas ID','B2B ID Sales'], ['Ventas IT ','IT Sales']];
		
		$data = [];
		foreach($depts as $dept){
			$org = $this->gen_m->unique("organization", "organization", $dept[0]);
			if ($org){
				$aux = ["organization_id" => $org->organization_id, "department" => $dept[1]];
				if (!$this->gen_m->filter("department", true, $aux)) $data[] = $aux;
			}else echo "No organization: ".$dept[0]."<br/>";
		}
		
		if ($data) echo $this->gen_m->insert_m("department", $data)." new record(s).";
		else echo "No record.";
	}
	
	public function preset_working_hour(){
		$whs = [['PR009062','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR008255','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009175','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR009311','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009092','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR009082','08:00 - 18:00','2000-01-01','2024-02-11'], ['PR009082','08:30 - 18:30','2024-02-12','2200-01-01'], ['PR009244','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR001736','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009309','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR001759','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR008956','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009333','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009119','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009297','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR008210','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008206','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009321','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009257','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009100','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009325','08:30 - 18:30','2000-01-01','2024-02-25'], ['PR009325','09:00 - 19:00','2024-02-26','2200-01-01'], ['PR008208','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009337','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008737','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008985','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009129','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009326','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR001871','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009207','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009327','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009248','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009210','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR008941','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009319','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009277','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR001849','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009015','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009172','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR009064','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009301','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008295','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR009289','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009180','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009229','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009335','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009027','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009156','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008522','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR008793','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR008161','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009132','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009070','07:00 - 17:00','2000-01-01','2200-01-01'], ['PR009242','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009243','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009234','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008144','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009310','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009174','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009130','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009134','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009201','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009224','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009088','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009329','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009060','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009293','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009230','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008756','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009305','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009232','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009179','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008451','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009216','09:15 - 19:15','2000-01-01','2200-01-01'], ['PR009246','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008770','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008969','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009113','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009033','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009153','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009252','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR008934','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009255','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009115','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009339','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008857','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR008612','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008644','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008754','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008901','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009102','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008641','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008656','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008860','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009286','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008457','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR001703','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR001762','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009299','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009190','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009160','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009031','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008733','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009236','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR008652','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009133','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009162','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008978','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009184','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR008780','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009303','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009109','09:30 - 19:30','2000-01-01','2200-01-01'], ['PR001808','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009226','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009238','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009163','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009239','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009237','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR008672','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008667','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR001100','07:00 - 17:00','2000-01-01','2200-01-01'], ['PR009200','07:00 - 17:00','2000-01-01','2200-01-01'], ['PR009204','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009250','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009212','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009011','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009206','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009220','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009249','08:00 - 18:00','2000-01-01','2200-01-01'], ['PR009105','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009254','07:30 - 17:30','2000-01-01','2200-01-01'], ['PR009291','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009331','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009103','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009177','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR008997','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR009287','08:30 - 18:30','2000-01-01','2200-01-01'], ['PR001724','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR009317','09:00 - 19:00','2000-01-01','2200-01-01'], ['PR001847','09:00 - 18:30','2000-01-01','2200-01-01'], ['PR008200','09:00 - 18:30','2000-01-01','2200-01-01']];
		
		$data = [];
		foreach($whs as $wh){
			//load employee
			$emp = $this->gen_m->unique("employee", "employee_number", $wh[0]);
			
			//load working hour option
			$times = explode(" - ", $wh[1]);
			$op_w = ["entrance_time" => $times[0], "exit_time" => $times[1]];
			$op = $this->gen_m->filter("working_hour_option", true, $op_w);
			if ($op) $op = $op[0];
			else{
				$op_id = $this->gen_m->insert("working_hour_option", $op_w);
				$op = $this->gen_m->unique("working_hour_option", "option_id", $op_id);
			}
			
			$aux = [
				"employee_id" => $emp->employee_id,
				"wh_option_id" => $op->option_id,
				"date_from" => $wh[2],
				"date_to" => $wh[3],
			];
			
			if (!$this->gen_m->filter("working_hour", true, $aux)) $data[] = $aux;
		}
		
		if ($data) echo $this->gen_m->insert_m("working_hour", $data)." new record(s).";
		else echo "No record.";
	}
	
	public function preset_vacation(){
		$vacations = [
			['PR009180','2024-01-02','2024-01-02','1','All','2024-01-16'], ['PR009204','2024-01-02','2024-01-02','1','All','2023-12-06'], ['PR009105','2024-01-02','2024-01-02','1','All','2023-12-13'], ['PR009011','2024-01-02','2024-01-02','1','All','2023-12-13'], ['PR009249','2024-01-02','2024-01-02','1','All','2023-12-14'], ['PR008934','2024-01-02','2024-01-02','1','All','2024-01-16'], ['PR009103','2024-01-02','2024-01-02','1','All','2023-12-21'], ['PR009246','2024-01-02','2024-01-02','1','All','2023-12-22'], ['PR009027','2024-01-02','2024-01-02','1','All','2023-12-15'], ['PR008522','2024-01-02','2024-01-02','1','All','2023-12-12'], ['PR009109','2024-01-02','2024-01-02','1','All','2023-12-30'], ['PR008144','2024-01-02','2024-01-02','1','All','2023-11-28'], ['PR009174','2024-01-02','2024-01-02','1','All','2023-12-13'], ['PR008667','2024-01-02','2024-01-03','2','All','2023-12-15'], ['PR009200','2024-01-02','2024-01-03','2','All','2023-12-28'], ['PR009250','2024-01-02','2024-01-03','2','All','2023-12-27'], ['PR009243','2024-01-02','2024-01-03','2','All','2023-12-29'], ['PR009212','2024-01-02','2024-01-05','4','All','2023-12-06'], ['PR009206','2024-01-02','2024-01-05','4','All','2023-12-14'], ['PR009177','2024-01-02','2024-01-05','4','All','2023-12-21'], ['PR008809','2024-01-02','2024-01-05','4','All','2023-02-13'], ['PR009216','2024-01-02','2024-01-05','4','All','2023-12-19'], ['PR008941','2024-01-02','2024-01-05','4','All','2023-12-29'], ['PR008161','2024-01-02','2024-01-05','4','All','2023-12-20'], ['PR009070','2024-01-02','2024-01-05','4','All','2023-12-23'], ['PR009303','2024-01-02','2024-01-05','4','All','2023-12-14'], ['PR009184','2024-01-02','2024-01-05','4','All','2024-01-16'], ['PR009220','2024-01-02','2024-01-08','7','All','2023-12-14'], ['PR009132','2024-01-03','2024-01-03','1','All','2023-12-30'], ['PR009153','2024-01-04','2024-01-05','2','All','2024-01-03'], ['PR009210','2024-01-05','2024-01-05','1','All','2024-01-05'], ['PR001759','2024-01-05','2024-01-05','1','All','2024-01-05'], ['PR009207','2024-01-05','2024-01-05','1','All','2024-01-05'], ['PR008255','2024-01-08','2024-01-08','1','All','2024-01-06'], ['PR009212','2024-01-08','2024-01-08','1','All','2024-01-10'], ['PR009327','2024-01-08','2024-01-08','1','All','2024-01-05'], ['PR009207','2024-01-08','2024-01-08','1','All','2024-01-08'], ['PR008161','2024-01-08','2024-01-10','3','All','2023-12-20'], ['PR009291','2024-01-08','2024-01-12','5','All','2024-01-03'], ['PR009070','2024-01-08','2024-01-12','5','All','2023-12-23'], ['PR009174','2024-01-08','2024-01-12','5','All','2024-01-06'], ['PR009133','2024-01-09','2024-01-09','0.5','Morning','2024-01-08'], ['PR008978','2024-01-09','2024-01-10','2','All','2024-01-03'], ['PR009133','2024-01-10','2024-01-11','2','All','2024-01-08'], ['PR009242','2024-01-10','2024-01-12','3','All','2024-01-10'], ['PR009249','2024-01-11','2024-01-11','0.5','Afternoon','2024-01-09'], ['PR008161','2024-01-11','2024-01-12','2','All','2024-01-11'], ['PR009200','2024-01-12','2024-01-12','0.5','Morning','2024-01-04'], ['PR009250','2024-01-12','2024-01-12','0.5','Morning','2024-01-04'], ['PR009156','2024-01-12','2024-01-12','0.5','Afternoon','2024-01-13'], ['PR009172','2024-01-12','2024-01-12','0.5','Morning','2024-01-10'], ['PR009092','2024-01-12','2024-01-12','0.5','Morning','2024-01-13'], ['PR009212','2024-01-12','2024-01-12','1','All','2024-01-17'], ['PR009220','2024-01-12','2024-01-12','1','All','2024-01-12'], ['PR001100','2024-01-15','2024-01-15','1','All','2024-01-13'], ['PR009103','2024-01-15','2024-01-15','1','All','2023-12-21'], ['PR009201','2024-01-15','2024-01-15','1','All','2024-01-13'], ['PR009301','2024-01-15','2024-01-15','1','All','2024-01-03'], ['PR008522','2024-01-15','2024-01-16','2','All','2024-01-11'], ['PR009242','2024-01-15','2024-01-17','3','All','2024-01-10'], ['PR009015','2024-01-15','2024-01-17','3','All','2024-02-07'], ['PR008255','2024-01-15','2024-01-19','5','All','2024-01-13'], ['PR009252','2024-01-16','2024-01-16','0.5','Afternoon','2024-01-16'], ['PR009289','2024-01-16','2024-01-19','4','All','2024-01-13'], ['PR009207','2024-01-17','2024-01-19','3','All','2024-01-17'], ['PR009244','2024-01-18','2024-01-18','0.5','Afternoon','2024-01-18'], ['PR001759','2024-01-18','2024-01-18','1','All','2024-01-18'], ['PR009200','2024-01-19','2024-01-19','0.5','Afternoon','2024-01-09'], ['PR009254','2024-01-19','2024-01-19','0.5','Morning','2024-01-06'], ['PR009103','2024-01-19','2024-01-19','0.5','Afternoon','2024-01-19'], ['PR009177','2024-01-19','2024-01-19','0.5','Morning','2024-01-17'], ['PR009216','2024-01-19','2024-01-19','0.5','Morning','2024-02-07'], ['PR009132','2024-01-19','2024-01-19','0.5','Morning','2024-01-16'], ['PR009172','2024-01-19','2024-01-19','0.5','Morning','2024-01-18'], ['PR008997','2024-01-19','2024-01-19','1','All','2024-01-19'], ['PR009119','2024-01-22','2024-01-23','2','All','2024-01-18'], ['PR009132','2024-01-22','2024-01-23','2','All','2024-01-16'], ['PR009027','2024-01-25','2024-01-25','0.5','Morning','2024-01-25'], ['PR009092','2024-01-25','2024-01-25','0.5','Afternoon','2024-01-25'], ['PR008934','2024-01-25','2024-01-25','1','All','2024-01-24'], ['PR009177','2024-01-25','2024-01-25','1','All','2024-01-23'], ['PR009201','2024-01-25','2024-01-26','2','All','2024-01-25'], ['PR001759','2024-01-25','2024-01-31','7','All','2024-01-25'], ['PR009252','2024-01-26','2024-01-26','0.5','Afternoon','2024-01-26'], ['PR009321','2024-01-26','2024-01-26','1','All','2024-01-12'], ['PR009254','2024-01-26','2024-01-26','1','All','2024-01-25'], ['PR009319','2024-01-26','2024-01-26','1','All','2024-01-12'], ['PR009287','2024-01-29','2024-01-30','2','All','2024-01-17'], ['PR009172','2024-01-29','2024-01-30','2','All','2024-01-24'], ['PR009321','2024-01-29','2024-02-02','5','All','2024-01-12'], ['PR009257','2024-01-29','2024-02-02','5','All','2024-01-06'], ['PR009134','2024-01-29','2024-02-02','5','All','2024-02-07'], ['PR009070','2024-01-30','2024-01-30','1','All','2024-01-29'], ['PR008934','2024-01-31','2024-01-31','0.5','Afternoon','2024-01-31'], ['PR008208','2024-01-31','2024-01-31','1','All','2024-01-30'], ['PR009011','2024-02-01','2024-02-01','0.5','Afternoon','2024-02-01'], ['PR008997','2024-02-01','2024-02-05','5','All','2023-12-15'], ['PR009246','2024-02-01','2024-02-09','9','All','2023-12-22'], ['PR008667','2024-02-02','2024-02-02','1','All','2024-01-30'], ['PR009250','2024-02-02','2024-02-02','1','All','2024-01-30'], ['PR009216','2024-02-02','2024-02-02','1','All','2024-02-07'], ['PR009319','2024-02-02','2024-02-02','1','All','2024-01-30'], ['PR008941','2024-02-02','2024-02-06','5','All','2024-02-02'], ['PR009070','2024-02-05','2024-02-05','0.5','Morning','2024-02-05'], ['PR009174','2024-02-05','2024-02-05','1','All','2024-02-06'], ['PR009257','2024-02-05','2024-02-09','5','All','2024-01-06'], ['PR009133','2024-02-05','2024-02-09','5','All','2024-02-01'], ['PR009207','2024-02-05','2024-02-09','5','All','2024-02-05'], ['PR009027','2024-02-05','2024-02-16','12','All','2024-01-04'], ['PR009088','2024-02-06','2024-02-06','0.5','Afternoon','2024-02-07'], ['PR009319','2024-02-06','2024-02-06','0.5','Afternoon','2024-02-06'], ['PR009015','2024-02-06','2024-02-06','0.5','Afternoon','2024-02-06'], ['PR008255','2024-02-06','2024-02-07','2','All','2024-02-06'], ['PR008934','2024-02-07','2024-02-07','1','All','2024-02-07'], ['PR009011','2024-02-08','2024-02-08','1','All','2024-02-01'], ['PR009204','2024-02-09','2024-02-09','1','All','2024-01-23'], ['PR009212','2024-02-09','2024-02-09','1','All','2024-02-07'], ['PR009254','2024-02-12','2024-02-12','1','All','2024-01-31'], ['PR009248','2024-02-12','2024-02-13','2','All','2024-02-05'], ['PR008144','2024-02-12','2024-02-14','3','All','2024-02-06'], ['PR009257','2024-02-12','2024-02-16','5','All','2024-01-06'], ['PR009252','2024-02-13','2024-02-15','3','All','2024-02-08'], ['PR009254','2024-02-14','2024-02-14','0.5','Afternoon','2024-01-30'], ['PR009287','2024-02-14','2024-02-15','2','All','2024-01-17'], ['PR008978','2024-02-14','2024-02-16','3','All','2024-02-06'], ['PR009172','2024-02-15','2024-02-15','1','All','2024-02-09'], ['PR009204','2024-02-15','2024-02-16','2','All','2024-01-23'], ['PR009250','2024-02-15','2024-02-16','2','All','2024-01-23'], ['PR009011','2024-02-15','2024-02-21','7','All','2024-02-01'], ['PR009206','2024-02-16','2024-02-16','0.5','Morning','2024-01-16'], ['PR009015','2024-02-19','2024-02-21','3','All','2024-02-06'], ['PR009257','2024-02-19','2024-02-23','5','All','2024-01-06'], ['PR009206','2024-02-21','2024-02-21','0.5','Afternoon','2024-01-16'], ['PR008737','2024-02-21','2024-02-22','2','All','2024-02-09'], ['PR008978','2024-02-21','2024-02-23','3','All','2024-02-06'], ['PR009249','2024-02-22','2024-02-23','2','All','2024-02-09'], ['PR009172','2024-02-26','2024-02-26','1','All','2024-02-09'], ['PR008737','2024-03-04','2024-03-05','2','All','2024-02-09'], ['PR009287','2024-03-25','2024-03-25','1','All','2024-01-17'], ['PR009234','2024-03-25','2024-03-27','3','All','2024-02-06'], ['PR009220','2024-04-01','2024-04-01','1','All','2024-02-09'], ['PR009172','2024-04-15','2024-04-19','5','All','2024-02-09'], ['PR009088','2024-05-02','2024-05-03','2','All','2024-01-04'], ['PR009156','2024-05-02','2024-05-03','2','All','2024-02-03'], ['PR009088','2024-05-06','2024-05-07','2','All','2024-01-04'], ['PR009156','2024-05-06','2024-05-10','5','All','2024-02-03'], ['PR009327','2024-05-06','2024-05-10','5','All','2024-02-08'], ['PR009172','2024-05-13','2024-05-13','1','All','2024-02-09'], ['PR009206','2024-05-13','2024-05-17','5','All','2024-01-16'], ['PR009156','2024-05-13','2024-05-17','5','All','2024-02-05'], ['PR008737','2024-05-13','2024-05-17','5','All','2024-02-09'], ['PR009156','2024-05-20','2024-05-22','3','All','2024-02-03'], ['PR009337','2024-05-22','2024-05-24','3','All','2024-02-09'], ['PR009337','2024-05-27','2024-05-28','2','All','2024-02-09'], ['PR009172','2024-06-17','2024-06-17','1','All','2024-02-09'], ['PR009337','2024-07-15','2024-07-19','5','All','2024-02-09'], ['PR008737','2024-07-30','2024-07-31','2','All','2024-02-09'], ['PR008737','2024-08-01','2024-08-02','2','All','2024-02-09'], ['PR008737','2024-08-05','2024-08-05','1','All','2024-02-09'], ['PR008737','2024-08-07','2024-08-09','3','All','2024-02-09'], ['PR009220','2024-09-13','2024-09-23','11','All','2024-02-09'], ['PR009337','2024-09-30','2024-10-04','5','All','2024-02-09'], ['PR009088','2024-10-01','2024-10-04','4','All','2024-01-04'], ['PR009088','2024-10-07','2024-10-07','1','All','2024-01-04'], ['PR009088','2024-10-09','2024-10-11','3','All','2024-01-04'], ['PR008737','2024-10-14','2024-10-18','5','All','2024-02-09'], ['PR009088','2024-10-30','2024-10-31','2','All','2024-01-17'], ['PR009088','2024-11-04','2024-11-05','2','All','2024-01-17'], ['PR009337','2024-11-28','2024-11-29','2','All','2024-02-09'], ['PR008934','2024-12-02','2024-12-02','1','All','2023-12-14'], ['PR009337','2024-12-02','2024-12-06','5','All','2024-02-09'], ['PR009234','2024-12-23','2025-01-03','12','All','2024-02-06']
		];
		
		$data = [];
		foreach($vacations as $vac){
			//load employee
			$emp = $this->gen_m->unique("employee", "employee_number", $vac[0]);
			
			//load type
			$type = $this->gen_m->unique("vacation_type", "type", $vac[4]);
			
			if ($emp){
				$aux = [
					"type_id" => $type->type_id,
					"employee_id" => $emp->employee_id,
					"date_from" => $vac[1],
					"date_to" => $vac[2],
					"day_count" => $vac[3],
					"register" => $vac[5],
				];
				if (!$this->gen_m->filter("vacation", true, $aux)) $data[] = $aux;
			}
			
		};
		
		if ($data) echo $this->gen_m->insert_m("vacation", $data)." new record(s).";
		else echo "No record.";
	}

	public function update_ep_mail(){
		$aux = json_decode('[["M60682453","andre.cho"],["M75951391","muhyun.han"],["M875S9193","wonshik.woo"],["PR001100","julio.mendozanoel"],["PR001703","cesar.zavaleta"],["PR001724","eduardo.miranda"],["PR001736","enrique.salazar"],["PR001762","elizabeth.mg"],["PR001808","pedro.paucar"],["PR001847","celia.obregon"],["PR001849","melisa.carbajal"],["PR001871","mariela.carbajal"],["PR008144","juan.chug"],["PR008161","diana.kanagusuku"],["PR008200","hector.zena"],["PR008206","andy.jimenez"],["PR008208","fatima.quiroz"],["PR008210","bion.hwang"],["PR008255","pilar.montano"],["PR008295","bo.seo"],["PR008451","patricia.pandolfi"],["PR008457","lesly.pizarro"],["PR008522","juan.pinillos"],["PR008612","jimmy.bautista"],["PR008641","jorge.calderon"],["PR008644","gladimir.jimenez"],["PR008652","jhony.laura"],["PR008656","ruben.armas"],["PR008667","christian.pastor"],["PR008672","fernando.novoa"],["PR008733","kurt.valdiviezo"],["PR008737","roberto.kawano"],["PR008754","edwin.galindo"],["PR008756","wagner.rojas"],["PR008770","claudia.torres"],["PR008780","rony.cortez"],["PR008793","paco.shim"],["PR008857","gari.luna"],["PR008860","susanae.jacinto"],["PR008901","richard.gil"],["PR008934","fabiola.garcia"],["PR008941","jhenmi.susaya"],["PR008956","juan.depaz"],["PR008969","lauco.neyra"],["PR008978","roberto.morales"],["PR008985","ricardo.alvarez"],["PR008997","javier.reategui"],["PR009011","ricardo.kanai"],["PR009015","deborah.vassallo"],["PR009027","elizabeth.gallegos"],["PR009031","arturo.huanca"],["PR009033","dario.vargas"],["PR009060","markus.caballero"],["PR009062","angella.castro"],["PR009064","chabelly.vargas"],["PR009070","giuliana.parra"],["PR009082","liz.llajaruna"],["PR009088","andreac.alfaro"],["PR009092","luis.pena"],["PR009100","jhon.flores"],["PR009102","jose.sarmiento"],["PR009103","sergio.bernabe"],["PR009105","alvaro.benavides"],["PR009109","christianr.arapa"],["PR009113","raul.oh"],["PR009115","jeongmo.gang"],["PR009119","teddy.nacimento"],["PR009129","mario.rosazza"],["PR009130","milagros.lengua"],["PR009132","marissela.torres"],["PR009133","esteban.lugo"],["PR009134","alfredo.carrillo"],["PR009153","cynthia.montero"],["PR009156","rodrigo.oyarce"],["PR009160","diego.irazabal"],["PR009162","alex1.delgado"],["PR009163","leslie.chavez"],["PR009172","rocio.carrasco"],["PR009174","danny.romero"],["PR009175","madeleyne.velasquez"],["PR009177","alfredo.calderon"],["PR009179","angel.coral"],["PR009180","pamela.astuhuaman"],["PR009182","andre.cho"],["PR009184","carlos.hinostroza"],["PR009190","carla.zapata"],["PR009200","ana.perales"],["PR009201","jhan.calua"],["PR009204","ricardo.alcazar"],["PR009206","ricardo.padilla"],["PR009207","brian.oyola"],["PR009210","elizabeth.sampe"],["PR009212","evelyn.cruz"],["PR009216","renato.freundt"],["PR009220","silvana.chavez"],["PR009224","sanguk.jeong"],["PR009226","patrick.lee"],["PR009229","ignacio.arellano"],["PR009230","seongmin1.lee"],["PR009232","agustin.fajardo"],["PR009234","sofia.huby"],["PR009236","freddy.vega"],["PR009237","dikharla.martinez"],["PR009238","yanira.morante"],["PR009239","wilmer.mallma"],["PR009242","cesar.rucoba"],["PR009243","ronald.chavez"],["PR009244","xilena.quezada"],["PR009246","milagros.arenas"],["PR009248","andrea.coria"],["PR009249","angelica.ginocchio"],["PR009250","morella.ruiz"],["PR009252","anaclaudia.yepez"],["PR009254","jose.altamirano"],["PR009255","hans.beuermann"],["PR009257","cristal.kim"],["PR009261","malena.taboada"],["PR009262","fernando.aquino"],["PR009263","alexia.mindikowski"],["PR009264","diego.ferreira"],["PR009265","ernesto.caceres"],["PR009266","simon.ma"],["PR009267","cinthia.rojas"],["PR009268","guido.granado"],["PR009269","leticia.cho"],["PR009270","jcarlos.morales"],["PR009274","patriciar.gonzalez"],["PR009275","aline.dasilva"],["PR009277","miluska.quispe"],["PR009286","luis.gallardo"],["PR009287","jose.rabanal"],["PR009289","laura.soplin"],["PR009291","josem.castillo"],["PR009293","luana.aita"],["PR009297","wonshik.woo"],["PR009299","jean.aguero"],["PR009301","kelly.hernandez"],["PR009303","edgard.chara"],["PR009305","luisangel.rodriguez"],["PR009309","maria.pomacaja"],["PR009310","francisco.cruz"],["PR009311","paola.avalos"],["PR009317","gianpierre.serna"],["PR009319","cesar.caballero"],["PR009321","jeter.retto"],["PR009323","andrea.riveros"],["PR009325","david.choi"],["PR009326","natali.andrade"],["PR009327","patricia.rivas"],["PR009329","muhyun.han"],["PR009331","martin.namuche"],["PR009333","diana.sanchez"],["PR009335","luis.suarez"],["PR009337","georgio.park"]]');
		
		foreach($aux as $a){
			$emp = $this->gen_m->unique("employee", "employee_number", $a[0]);
			
			$this->gen_m->update("employee", ["employee_id" => $emp->employee_id], ["ep_mail" => $a[1]]);
			print_r($a); echo "<br/>";
			print_r($emp); echo "<br/>";
			echo "<br/>";
		}
	}
}
