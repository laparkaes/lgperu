CREATE VIEW v_lgepr_adjusted_sales_order AS
SELECT
    sales_order_id AS order_id,
    'sales_order' AS order_table,
    customer_department AS customer_department,
    dash_company AS dash_company,
    dash_division AS dash_division,
    model_category AS model_category,
    order_category AS category,
    order_type AS order_type,
    bill_to AS bill_to_code,
    bill_to_name AS bill_to_name,
    ship_to AS ship_to_code,
    ship_to_name AS ship_to_name,
    customer_name AS customer_name,
    order_no AS order_no,
    line_no AS line_no,
    model AS model,
    ordered_qty AS order_qty,
    sales_amount_usd AS order_amount_usd,
    line_status AS line_status,
    so_status AS so_status,
    booked_date AS order_date,
    req_arrival_date_to AS req_arrival_date_to,
    appointment_date AS appointment_date,
    shipment_date AS shipment_date,
    NULL AS closed_date,
    inventory_org AS inventory_org,
    sub_inventory AS sub_inventory,
    customer_po_no AS customer_po_no,
    om_line_status AS om_line_status,
    om_appointment AS om_appointment,
    om_appointment_remark AS om_appointment_remark,
    om_updated_at AS om_updated_at,
    cbm AS item_cbm,
    product_level1_name AS product_level1_name,
    product_level2_name AS product_level2_name,
    product_level3_name AS product_level3_name,
    product_level4_name AS product_level4_name,
    product_level4_code AS product_level4_code,
    hold_flag AS hold_flag,
    instock_flag AS instock_flag,
    back_order_hold AS back_order_hold,
    credit_hold AS credit_hold,
    overdue_hold AS overdue_hold,
    customer_hold AS customer_hold,
    payterm_term_hold AS payterm_term_hold,
    fp_hold AS fp_hold,
    minimum_hold AS minimum_hold,
    future_hold AS future_hold,
    reserve_hold AS reserve_hold,
    manual_hold AS manual_hold,
    auto_pending_hold AS auto_pending_hold,
    sa_hold AS sa_hold,
    form_hold AS form_hold,
    bank_collateral_hold AS bank_collateral_hold,
    insurance_hold AS insurance_hold,
    partial_flag AS partial_flag,
    load_hold_flag AS load_hold_flag,
    updated_at AS updated_at
FROM
    lgepr_sales_order so
WHERE NOT EXISTS (
    SELECT 1
    FROM lgepr_closed_order co
    WHERE co.order_no = so.order_no
      AND co.line_no = so.line_no
);